(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.dateFormatter = dateFormatter;

function dateFormatter(date) {
  var dateString = '';
  if (date) {
    dateString = ('0' + date.getHours()).slice(-2) + ':' + ('0' + date.getMinutes()).slice(-2);
  }
  return dateString;
}

;

},{}],2:[function(require,module,exports){
'use strict';

var _dateFormatter = require('./date-formatter');

(function ($) {
  'use strict';

  $.fn.schedule = function (option) {
    var millisecondsToHour = 60 * 60 * 1000;
    var api = undefined;

    // timeline
    var drawTimeLine = function drawTimeLine(timeLine, dateFormatter) {
      var result = '<div class="schedule__timeline">';
      timeLine.slice(0, -1).forEach(function (time) {
        result += '<div class="schedule__time"' + 'style="height:' + time.height + '">' + dateFormatter(time.time) + '</div>';
      });
      return result + '</div>';
    };

    var getTimeLine = function getTimeLine(events) {
      var timeLine = [];
      var timeList = [];
      events.forEach(function (event, i) {
        if (timeList.map(Number).indexOf(event.startTime.valueOf()) === -1) {
          timeList.push(event.startTime);
        }
        if (timeList.map(Number).indexOf(event.endTime.valueOf()) === -1) {
          timeList.push(event.endTime);
        }
      });
      timeList.sort();

      timeList.reduce(function (previousValue, currentValue) {
        var difference;
        var height;
        difference = Math.abs(previousValue - currentValue);
        height = difference * (api.heightHour / millisecondsToHour);
        timeLine.push({
          time: previousValue,
          height: height + 'px'
        });
        return currentValue;
      });
      timeLine.push({
        time: timeList[timeList.length - 1],
        height: 'auto'
      });
      return timeLine;
    };

    //title
    var drawTitles = function drawTitles(columns, titleFormatter) {
      var title = '<div class="schedule__titles">';
      var widthTitle = api.widthTimeBlock;
      columns.forEach(function (column) {
        title += '<div class="schedule__title"' + 'style="width:' + widthTitle + 'px;">' + titleFormatter(column) + '</div>';
      });
      return title + '</div>';
    };

    var titleFormatter = function titleFormatter(column) {
      return '<div>' + column.title + '</div>';
    };

    // events
    var eventsFormatter = function eventsFormatter(event) {
      return '<div>' + event.startTime.getHours() + ':' + event.startTime.getMinutes() + ' - ' + event.endTime.getHours() + ':' + event.endTime.getMinutes() + '</div>' + '<div>' + event.data.title + '</div>' + '<div>' + event.data.text + '</div>';
    };

    var drawEvents = function drawEvents(events, timeLine, eventsFormatter) {
      var result = document.createElement('div');
      var height = getTimeLineHeight(timeLine);
      result.className = 'schedule__events';
      result.style.height = height;
      events.forEach(function (event) {
        var position = getEventPosition(event, timeLine);
        var eventItem = document.createElement('div');
        eventItem.style.position = 'absolute';
        eventItem.style.top = position.top;
        eventItem.style.bottom = position.bottom;
        eventItem.style.left = position.left;
        eventItem.style.width = api.widthTimeBlock;
        eventItem.innerHTML = eventsFormatter(event);
        result.appendChild(eventItem);
      });

      return result;
    };

    var getEventPosition = function getEventPosition(event, timeLine) {
      var position = {};
      position.left = getLeftEventPosition(event.column);
      position.top = getTopEventPosition(event, timeLine);
      position.bottom = getBottomEventPosition(event, timeLine);
      return position;
    };
    var getLeftEventPosition = function getLeftEventPosition(column) {
      var result;
      var width = api.widthTimeBlock;
      result = width * (column - 1) + 'px';
      return result;
    };
    var getTopEventPosition = function getTopEventPosition(event, timeLine) {
      var startEventTime = event.startTime;
      var beginTime = timeLine[0].time;
      var difference = startEventTime - beginTime;
      var top = difference * (api.heightHour / millisecondsToHour);
      return top + 'px';
    };
    var getBottomEventPosition = function getBottomEventPosition(event, timeLine) {
      var endEventTime = event.endTime;
      var endTime = timeLine[timeLine.length - 1].time;
      var difference = endTime - endEventTime;
      var bottom = difference * (api.heightHour / millisecondsToHour);
      return bottom + 'px';
    };

    //data

    var getTimeLineHeight = function getTimeLineHeight(timeline) {
      var start = timeline[0].time;
      var end = timeline[timeline.length - 1].time;
      var difference = end - start;
      var height = difference * (api.heightHour / millisecondsToHour);
      return height;
    };

    var drawSchedule = function drawSchedule(data) {
      var titleHtml = drawTitles(data.columns, api.titleFormatter);
      var timeLine = getTimeLine(data.events);
      var timeLineHtml = drawTimeLine(timeLine, api.dateFormatter);
      var eventsHtml = document.createElement('div');
      eventsHtml.appendChild(drawEvents(data.events, timeLine, api.eventsFormatter));
      schedule.html(timeLineHtml + '<div class="schedule__events-container">' + titleHtml + eventsHtml.innerHTML + '</div>');
    };

    var schedule = this;
    api = $.extend({
      titleFormatter: titleFormatter,
      dateFormatter: _dateFormatter.dateFormatter,
      eventsFormatter: eventsFormatter,
      heightHour: 100,
      widthTimeBlock: 300
    }, option);

    api.data(drawSchedule);
    return this;
  };
})(jQuery);

},{"./date-formatter":1}]},{},[2])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvc2V2ZW5iaXRzL3Byb2plY3RzL2V2ZW50LXNjaGVkdWxlL3NyYy9kYXRlLWZvcm1hdHRlci5qcyIsIi9Vc2Vycy9zZXZlbmJpdHMvcHJvamVjdHMvZXZlbnQtc2NoZWR1bGUvc3JjL2V2ZW50LXNjaGVkdWxlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUEsWUFBWSxDQUFDOzs7OztRQUVHLGFBQWEsR0FBYixhQUFhOztBQUF0QixTQUFTLGFBQWEsQ0FBQyxJQUFJLEVBQUU7QUFDbEMsTUFBSSxVQUFVLEdBQUcsRUFBRSxDQUFDO0FBQ3BCLE1BQUksSUFBSSxFQUFFO0FBQ1IsY0FBVSxHQUFHLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQSxDQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FDbEQsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFBLENBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7R0FDdkM7QUFDRCxTQUFPLFVBQVUsQ0FBQztDQUNuQjs7QUFBQSxDQUFDOzs7Ozs2QkNUNEIsa0JBQWtCOztBQUVoRCxDQUFDLFVBQVMsQ0FBQyxFQUFFO0FBQ1gsY0FBWSxDQUFDOztBQUViLEdBQUMsQ0FBQyxFQUFFLENBQUMsUUFBUSxHQUFHLFVBQVMsTUFBTSxFQUFFO0FBQy9CLFFBQUksa0JBQWtCLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUM7QUFDeEMsUUFBSSxHQUFHLFlBQUEsQ0FBQzs7O0FBR1IsUUFBSSxZQUFZLEdBQUcsU0FBZixZQUFZLENBQVksUUFBUSxFQUFFLGFBQWEsRUFBRTtBQUNuRCxVQUFJLE1BQU0sR0FBRyxrQ0FBa0MsQ0FBQztBQUNoRCxjQUFRLENBQUMsS0FBSyxDQUFDLENBQUMs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LENBQUM7QUFDN0QsVUFBSSxRQUFRLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUN4QyxVQUFJLFlBQVksR0FBRyxZQUFZLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUM3RCxVQUFJLFVBQVUsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQy9DLGdCQUFVLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxHQUFHLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztBQUMvRSxjQUFRLENBQUMsSUFBSSxDQUFDLFlBQVksR0FBRywwQ0FBMEMsR0FBRyxTQUFTLEdBQUcsVUFBVSxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUMsQ0FBQztLQUN4SCxDQUFDOztBQUdGLFFBQUksUUFBUSxHQUFHLElBQUksQ0FBQztBQUNwQixPQUFHLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQztBQUNiLG9CQUFjLEVBQUUsY0FBYztBQUM5QixtQkFBYSxpQkF0SlYsYUFBYSxBQXNKWTtBQUM1QixxQkFBZSxFQUFFLGVBQWU7QUFDaEMsZ0JBQVUsRUFBRSxHQUFHO0FBQ2Ysb0JBQWMsRUFBRSxHQUFHO0tBQ3BCLEVBQUUsTUFBTSxDQUFDLENBQUM7O0FBRVgsT0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUN2QixXQUFPLElBQUksQ0FBQztHQUNiLENBQUM7Q0FDSCxDQUFBLENBQUUsTUFBTSxDQUFDLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnQgZnVuY3Rpb24gZGF0ZUZvcm1hdHRlcihkYXRlKSB7XG4gIGxldCBkYXRlU3RyaW5nID0gJyc7XG4gIGlmIChkYXRlKSB7XG4gICAgZGF0ZVN0cmluZyA9ICgnMCcgKyBkYXRlLmdldEhvdXJzKCkpLnNsaWNlKC0yKSArICc6JyArXG4gICAgICAoJzAnICsgZGF0ZS5nZXRNaW51dGVzKCkpLnNsaWNlKC0yKTtcbiAgfVxuICByZXR1cm4gZGF0ZVN0cmluZztcbn07XG4iLCJpbXBvcnQgeyBkYXRlRm9ybWF0dGVyIH0gZnJvbSBcIi4vZGF0ZS1mb3JtYXR0ZXJcIjtcblxuKGZ1bmN0aW9uKCQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gICQuZm4uc2NoZWR1bGUgPSBmdW5jdGlvbihvcHRpb24pIHtcbiAgICB2YXIgbWlsbGlzZWNvbmRzVG9Ib3VyID0gNjAgKiA2MCAqIDEwMDA7XG4gICAgbGV0IGFwaTtcblxuICAgIC8vIHRpbWVsaW5lXG4gICAgdmFyIGRyYXdUaW1lTGluZSA9IGZ1bmN0aW9uKHRpbWVMaW5lLCBkYXRlRm9ybWF0dGVyKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gJzxkaXYgY2xhc3M9XCJzY2hlZHVsZV9fdGltZWxpbmVcIj4nO1xuICAgICAgdGltZUxpbmUuc2xpY2UoMCwgLTEpLmZvckVhY2goZnVuY3Rpb24odGltZSkge1xuICAgICAgICByZXN1bHQgKz0gJzxkaXYgY2xhc3M9XCJzY2hlZHVsZV9fdGltZVwiJyArXG4gICAgICAgICAgJ3N0eWxlPVwiaGVpZ2h0OicgKyB0aW1lLmhlaWdodCArICdcIj4nICtcbiAgICAgICAgICBkYXRlRm9ybWF0dGVyKHRpbWUudGltZSkgKyAnPC9kaXY+JztcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJlc3VsdCArICc8L2Rpdj4nO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0VGltZUxpbmUgPSBmdW5jdGlvbihldmVudHMpIHtcbiAgICAgIHZhciB0aW1lTGluZSA9IFtdO1xuICAgICAgdmFyIHRpbWVMaXN0ID0gW107XG4gICAgICBldmVudHMuZm9yRWFjaChmdW5jdGlvbihldmVudCwgaSkge1xuICAgICAgICBpZiAodGltZUxpc3QubWFwKE51bWJlcikuaW5kZXhPZihldmVudC5zdGFydFRpbWUudmFsdWVPZigpKSA9PT0gLTEpIHtcbiAgICAgICAgICB0aW1lTGlzdC5wdXNoKGV2ZW50LnN0YXJ0VGltZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRpbWVMaXN0Lm1hcChOdW1iZXIpLmluZGV4T2YoZXZlbnQuZW5kVGltZS52YWx1ZU9mKCkpID09PSAtMSkge1xuICAgICAgICAgIHRpbWVMaXN0LnB1c2goZXZlbnQuZW5kVGltZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGltZUxpc3Quc29ydCgpO1xuXG4gICAgICB0aW1lTGlzdC5yZWR1Y2UoZnVuY3Rpb24ocHJldmlvdXNWYWx1ZSwgY3VycmVudFZhbHVlKSB7XG4gICAgICAgIHZhciBkaWZmZXJlbmNlO1xuICAgICAgICB2YXIgaGVpZ2h0O1xuICAgICAgICBkaWZmZXJlbmNlID0gTWF0aC5hYnMocHJldmlvdXNWYWx1ZSAtIGN1cnJlbnRWYWx1ZSk7XG4gICAgICAgIGhlaWdodCA9IGRpZmZlcmVuY2UgKiAoYXBpLmhlaWdodEhvdXIgLyBtaWxsaXNlY29uZHNUb0hvdXIpO1xuICAgICAgICB0aW1lTGluZS5wdXNoKHtcbiAgICAgICAgICB0aW1lOiBwcmV2aW91c1ZhbHVlLFxuICAgICAgICAgIGhlaWdodDogaGVpZ2h0ICsgJ3B4J1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRWYWx1ZTtcbiAgICAgIH0pO1xuICAgICAgdGltZUxpbmUucHVzaCh7XG4gICAgICAgIHRpbWU6IHRpbWVMaXN0W3RpbWVMaXN0Lmxlbmd0aCAtIDFdLFxuICAgICAgICBoZWlnaHQ6ICdhdXRvJ1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gdGltZUxpbmU7XG4gICAgfTtcblxuXG4gICAgLy90aXRsZVxuICAgIHZhciBkcmF3VGl0bGVzID0gZnVuY3Rpb24oY29sdW1ucywgdGl0bGVGb3JtYXR0ZXIpIHtcbiAgICAgIHZhciB0aXRsZSA9ICc8ZGl2IGNsYXNzPVwic2NoZWR1bGVfX3RpdGxlc1wiPic7XG4gICAgICB2YXIgd2lkdGhUaXRsZSA9IGFwaS53aWR0aFRpbWVCbG9jaztcbiAgICAgIGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihjb2x1bW4pIHtcbiAgICAgICAgdGl0bGUgKz0gJzxkaXYgY2xhc3M9XCJzY2hlZHVsZV9fdGl0bGVcIicgK1xuICAgICAgICAgICdzdHlsZT1cIndpZHRoOicgKyB3aWR0aFRpdGxlICsgJ3B4O1wiPicgK1xuICAgICAgICAgIHRpdGxlRm9ybWF0dGVyKGNvbHVtbikgKyAnPC9kaXY+JztcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRpdGxlICsgJzwvZGl2Pic7XG4gICAgfTtcblxuICAgIHZhciB0aXRsZUZvcm1hdHRlciA9IGZ1bmN0aW9uKGNvbHVtbikge1xuICAgICAgcmV0dXJuICc8ZGl2PicgKyBjb2x1bW4udGl0bGUgKyAnPC9kaXY+JztcbiAgICB9O1xuXG5cbiAgICAvLyBldmVudHNcbiAgICB2YXIgZXZlbnRzRm9ybWF0dGVyID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgIHJldHVybiAnPGRpdj4nICsgZXZlbnQuc3RhcnRUaW1lLmdldEhvdXJzKCkgKyAnOicgK1xuICAgICAgICBldmVudC5zdGFydFRpbWUuZ2V0TWludXRlcygpICsgJyAtICcgK1xuICAgICAgICBldmVudC5lbmRUaW1lLmdldEhvdXJzKCkgKyAnOicgK1xuICAgICAgICBldmVudC5lbmRUaW1lLmdldE1pbnV0ZXMoKSArICc8L2Rpdj4nICtcbiAgICAgICAgJzxkaXY+JyArIGV2ZW50LmRhdGEudGl0bGUgKyAnPC9kaXY+JyArXG4gICAgICAgICc8ZGl2PicgKyBldmVudC5kYXRhLnRleHQgKyAnPC9kaXY+JztcbiAgICB9O1xuXG4gICAgdmFyIGRyYXdFdmVudHMgPSBmdW5jdGlvbihldmVudHMsIHRpbWVMaW5lLCBldmVudHNGb3JtYXR0ZXIpIHtcbiAgICAgIHZhciByZXN1bHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHZhciBoZWlnaHQgPSBnZXRUaW1lTGluZUhlaWdodCh0aW1lTGluZSk7XG4gICAgICByZXN1bHQuY2xhc3NOYW1lID0gJ3NjaGVkdWxlX19ldmVudHMnO1xuICAgICAgcmVzdWx0LnN0eWxlLmhlaWdodCA9IGhlaWdodDtcbiAgICAgIGV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHZhciBwb3NpdGlvbiA9IGdldEV2ZW50UG9zaXRpb24oZXZlbnQsIHRpbWVMaW5lKTtcbiAgICAgICAgdmFyIGV2ZW50SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBldmVudEl0ZW0uc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgICAgICBldmVudEl0ZW0uc3R5bGUudG9wID0gcG9zaXRpb24udG9wO1xuICAgICAgICBldmVudEl0ZW0uc3R5bGUuYm90dG9tID0gcG9zaXRpb24uYm90dG9tO1xuICAgICAgICBldmVudEl0ZW0uc3R5bGUubGVmdCA9IHBvc2l0aW9uLmxlZnQ7XG4gICAgICAgIGV2ZW50SXRlbS5zdHlsZS53aWR0aCA9IGFwaS53aWR0aFRpbWVCbG9jaztcbiAgICAgICAgZXZlbnRJdGVtLmlubmVySFRNTCA9IGV2ZW50c0Zvcm1hdHRlcihldmVudCk7XG4gICAgICAgIHJlc3VsdC5hcHBlbmRDaGlsZChldmVudEl0ZW0pO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcblxuICAgIHZhciBnZXRFdmVudFBvc2l0aW9uID0gZnVuY3Rpb24oZXZlbnQsIHRpbWVMaW5lKSB7XG4gICAgICB2YXIgcG9zaXRpb24gPSB7fTtcbiAgICAgIHBvc2l0aW9uLmxlZnQgPSBnZXRMZWZ0RXZlbnRQb3NpdGlvbihldmVudC5jb2x1bW4pO1xuICAgICAgcG9zaXRpb24udG9wID0gZ2V0VG9wRXZlbnRQb3NpdGlvbihldmVudCwgdGltZUxpbmUpO1xuICAgICAgcG9zaXRpb24uYm90dG9tID0gZ2V0Qm90dG9tRXZlbnRQb3NpdGlvbihldmVudCwgdGltZUxpbmUpO1xuICAgICAgcmV0dXJuIHBvc2l0aW9uO1xuICAgIH07XG4gICAgdmFyIGdldExlZnRFdmVudFBvc2l0aW9uID0gZnVuY3Rpb24oY29sdW1uKSB7XG4gICAgICB2YXIgcmVzdWx0O1xuICAgICAgdmFyIHdpZHRoID0gYXBpLndpZHRoVGltZUJsb2NrO1xuICAgICAgcmVzdWx0ID0gd2lkdGggKiAoY29sdW1uIC0gMSkgKyAncHgnO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuICAgIHZhciBnZXRUb3BFdmVudFBvc2l0aW9uID0gZnVuY3Rpb24oZXZlbnQsIHRpbWVMaW5lKSB7XG4gICAgICB2YXIgc3RhcnRFdmVudFRpbWUgPSBldmVudC5zdGFydFRpbWU7XG4gICAgICB2YXIgYmVnaW5UaW1lID0gdGltZUxpbmVbMF0udGltZTtcbiAgICAgIHZhciBkaWZmZXJlbmNlID0gc3RhcnRFdmVudFRpbWUgLSBiZWdpblRpbWU7XG4gICAgICB2YXIgdG9wID0gZGlmZmVyZW5jZSAqIChhcGkuaGVpZ2h0SG91ciAvIG1pbGxpc2Vjb25kc1RvSG91cik7XG4gICAgICByZXR1cm4gdG9wICsgJ3B4JztcbiAgICB9O1xuICAgIHZhciBnZXRCb3R0b21FdmVudFBvc2l0aW9uID0gZnVuY3Rpb24oZXZlbnQsIHRpbWVMaW5lKSB7XG4gICAgICB2YXIgZW5kRXZlbnRUaW1lID0gZXZlbnQuZW5kVGltZTtcbiAgICAgIHZhciBlbmRUaW1lID0gdGltZUxpbmVbdGltZUxpbmUubGVuZ3RoIC0gMV0udGltZTtcbiAgICAgIHZhciBkaWZmZXJlbmNlID0gZW5kVGltZSAtIGVuZEV2ZW50VGltZTtcbiAgICAgIHZhciBib3R0b20gPSBkaWZmZXJlbmNlICogKGFwaS5oZWlnaHRIb3VyIC8gbWlsbGlzZWNvbmRzVG9Ib3VyKTtcbiAgICAgIHJldHVybiBib3R0b20gKyAncHgnO1xuICAgIH07XG5cbiAgICAvL2RhdGFcblxuICAgIHZhciBnZXRUaW1lTGluZUhlaWdodCA9IGZ1bmN0aW9uKHRpbWVsaW5lKSB7XG4gICAgICB2YXIgc3RhcnQgPSB0aW1lbGluZVswXS50aW1lO1xuICAgICAgdmFyIGVuZCA9IHRpbWVsaW5lW3RpbWVsaW5lLmxlbmd0aCAtIDFdLnRpbWU7XG4gICAgICB2YXIgZGlmZmVyZW5jZSA9IGVuZCAtIHN0YXJ0O1xuICAgICAgdmFyIGhlaWdodCA9IGRpZmZlcmVuY2UgKiAoYXBpLmhlaWdodEhvdXIgLyBtaWxsaXNlY29uZHNUb0hvdXIpO1xuICAgICAgcmV0dXJuIGhlaWdodDtcbiAgICB9O1xuXG4gICAgdmFyIGRyYXdTY2hlZHVsZSA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgIHZhciB0aXRsZUh0bWwgPSBkcmF3VGl0bGVzKGRhdGEuY29sdW1ucywgYXBpLnRpdGxlRm9ybWF0dGVyKTtcbiAgICAgIHZhciB0aW1lTGluZSA9IGdldFRpbWVMaW5lKGRhdGEuZXZlbnRzKTtcbiAgICAgIHZhciB0aW1lTGluZUh0bWwgPSBkcmF3VGltZUxpbmUodGltZUxpbmUsIGFwaS5kYXRlRm9ybWF0dGVyKTtcbiAgICAgIHZhciBldmVudHNIdG1sID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBldmVudHNIdG1sLmFwcGVuZENoaWxkKGRyYXdFdmVudHMoZGF0YS5ldmVudHMsIHRpbWVMaW5lLCBhcGkuZXZlbnRzRm9ybWF0dGVyKSk7XG4gICAgICBzY2hlZHVsZS5odG1sKHRpbWVMaW5lSHRtbCArICc8ZGl2IGNsYXNzPVwic2NoZWR1bGVfX2V2ZW50cy1jb250YWluZXJcIj4nICsgdGl0bGVIdG1sICsgZXZlbnRzSHRtbC5pbm5lckhUTUwgKyAnPC9kaXY+Jyk7XG4gICAgfTtcblxuXG4gICAgdmFyIHNjaGVkdWxlID0gdGhpcztcbiAgICBhcGkgPSAkLmV4dGVuZCh7XG4gICAgICB0aXRsZUZvcm1hdHRlcjogdGl0bGVGb3JtYXR0ZXIsXG4gICAgICBkYXRlRm9ybWF0dGVyOiBkYXRlRm9ybWF0dGVyLFxuICAgICAgZXZlbnRzRm9ybWF0dGVyOiBldmVudHNGb3JtYXR0ZXIsXG4gICAgICBoZWlnaHRIb3VyOiAxMDAsXG4gICAgICB3aWR0aFRpbWVCbG9jazogMzAwXG4gICAgfSwgb3B0aW9uKTtcblxuICAgIGFwaS5kYXRhKGRyYXdTY2hlZHVsZSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG59KShqUXVlcnkpO1xuIl19
